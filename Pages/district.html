<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>District Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/css/dis2.css"/>
  <style>
    #main-content {
      display: none;
    }
  </style>
</head>
<body>

<!-- Content wrapper (hidden until data loads) -->
<div id="main-content">

  <!-- Header Top -->
  <div class="top-header d-flex justify-content-between align-items-center px-4 py-2">
    <div class="district-title">Welcome to <span id="district-name-header">[District Name]</span></div>
    <img src="../img/file.svg" alt="IndiaInfo Logo" class="indiainfo-logo">
  </div>

  <!-- Navbar -->
  <!-- Navbar Start -->
  <nav class="navbar navbar-expand-lg custom-navbar">
    <div class="container-fluid">
      <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarDistrict">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarDistrict">
        <ul class="navbar-nav w-100 justify-content-around">
          <li class="nav-item"><a class="nav-link" href="index.html">HOME</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#">ABOUT DISTRICT</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">DISTRICT PROFILE</a></li>
              <li><a class="dropdown-item" href="#">MAP OF DISTRICT</a></li>
              <li><a class="dropdown-item" href="#">DEMOGRAPHY</a></li>
              <li><a class="dropdown-item" href="#">PRODUCE</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#">ADMINISTRATIVE SETUP</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">LIST OF RD BLOCKS</a></li>
              <li><a class="dropdown-item" href="#">VILLAGE / PANCHAYAT</a></li>
              <li><a class="dropdown-item" href="#">POLICE</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#">DIRECTORY</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">DM PROFILE</a></li>
              <li><a class="dropdown-item" href="#">HELPLINE</a></li>
              <li><a class="dropdown-item" href="#">TASK FORCE</a></li>
              <li><a class="dropdown-item" href="#">STD & PIN CODES</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#">PUBLIC UTILITIES</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">BANKS</a></li>
              <li><a class="dropdown-item" href="#">COLLEGES / UNIVERSITIES</a></li>
              <li><a class="dropdown-item" href="#">HOSPITALS</a></li>
              <li><a class="dropdown-item" href="#">MUNICIPALITIES</a></li>
              <li><a class="dropdown-item" href="#">NGOS</a></li>
              <li><a class="dropdown-item" href="#">POSTAL</a></li>
              <li><a class="dropdown-item" href="#">SCHOOLS</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#">DEPARTMENTS</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">AH & VETY</a></li>
              <li><a class="dropdown-item" href="#">REVENUE DEPARTMENT</a></li>
              <li><a class="dropdown-item" href="#">DCSO</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#">TOURISM</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">ENTRY FORMALITY</a></li>
              <li><a class="dropdown-item" href="#">HOW TO REACH</a></li>
              <li><a class="dropdown-item" href="#">WHERE TO STAY</a></li>
              <li><a class="dropdown-item" href="#">TOURIST PLACES</a></li>
              <li><a class="dropdown-item" href="#">ADVENTURES</a></li>
              <li><a class="dropdown-item" href="#">FESTIVALS</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#">MEDIA GALLERY</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">PHOTO GALLERY</a></li>
              <li><a class="dropdown-item" href="#">VIDEO GALLERY</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#">CITIZEN SERVICES</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">SCHEMES</a></li>
              <li><a class="dropdown-item" href="#">NOTICES</a></li>
              <li><a class="dropdown-item" href="#">FORMS</a></li>
              <li><a class="dropdown-item" href="#">RTI</a></li>
              <li><a class="dropdown-item" href="#">ARCHIVES</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- About District Section -->
  <section class="about-district-section container py-4">
    <h2 class="text-center mb-4">About the District</h2>
    <div class="row align-items-center">
      <div class="col-md-8">
        <p class="about-text" id="district-about">Loading district description...</p>
      </div>
      <div class="col-md-4 text-center">
        <img id="dm-photo" src="img/default.jpg" alt="DM Photo" class="img-fluid rounded shadow-sm" style="max-height: 200px;" />
        <p class="mt-2 fw-bold" id="district-name">District Magistrate</p>
      </div>
    </div>
  </section>

  <!-- Info Box Section -->
  <section class="glance-utilities-box py-4">
    <div class="container">
      <div class="row box-content p-4 rounded">
        <div class="col-md-6 text-white">
          <h4 class="fw-bold mb-3">DISTRICT AT A GLANCE</h4>
          <a href="#" class="glance-box bg-blue" id="area"></a>
          <a href="#" class="glance-box bg-red" id="population"></a>
          <a href="#" class="glance-box bg-green" id="literacy"></a>
          <a href="#" class="glance-box bg-gray" id="blocks"></a>
          <a href="#" class="glance-box bg-orange" id="villages"></a>
          <a href="#" class="glance-box bg-purple" id="municipality"></a>
          <a href="#" class="glance-box bg-darkgray" id="police"></a>
        </div>

        <div class="col-md-6 text-white">
          <h4 class="fw-bold mb-3">PUBLIC UTILITIES</h4>
          <div class="utility-box bg-blue" id="banks"></div>
          <div class="utility-box bg-red" id="hospitals"></div>
          <div class="utility-box bg-green" id="ngos"></div>
          <div class="utility-box bg-gray" id="schools"></div>
          <div class="utility-box bg-orange" id="colleges"></div>
          <div class="utility-box bg-darkgray" id="postal"></div>
        </div>
      </div>
    </div>
  </section>

</div> <!-- end #main-content -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
const params = new URLSearchParams(window.location.search);
const districtName = params.get('district');

if (!districtName) {
  alert("District name not provided in URL.");
} else {
  fetch(`/api/district?district=${districtName}`)
    .then(res => {
      if (!res.ok) throw new Error('District not found');
      return res.json();
    })
    .then(data => {
      if (!data || !data.name) throw new Error("Incomplete data");

      // Show content after successful load
      document.getElementById("main-content").style.display = "block";

      document.getElementById('district-name-header').innerText = data.name;
      const aboutText = (data.about && data.about.trim() !== '')
        ? data.about
        : `${data.name} is a beautiful region known for its natural beauty, cultural diversity, and historical significance.`;

      document.getElementById('district-about').innerText = aboutText;
      document.getElementById('district-name').innerText = `District Magistrate, ${data.name}`;

      // const photo = document.getElementById('dm-photo');
      // photo.src = `/img/dm/${data.dm_photo || 'default.jpg'}`;
      // photo.alt = `${data.name} DM Photo`;

      const photo = document.getElementById('dm-photo');
      const photoPath = data.dm_photo || 'default.jpg';

      if (photoPath.startsWith('http://') || photoPath.startsWith('https://')) {
        photo.src = photoPath;
      } else {
        photo.src = `/img/dm/${photoPath}`;
      }

      photo.alt = `${data.name} DM Photo`;


      document.getElementById('area').innerText = `Area: ${data.area}`;
      document.getElementById('population').innerText = `Population: ${data.population}`;
      document.getElementById('literacy').innerText = `Literacy Rate: ${data.literacy_rate}`;
      document.getElementById('blocks').innerText = `Blocks: ${data.blocks}`;
      document.getElementById('villages').innerText = `Villages: ${data.villages}`;
      document.getElementById('municipality').innerText = `Municipalities: ${data.municipalities}`;
      document.getElementById('police').innerText = `Police Stations: ${data.police_stations}`;

      document.getElementById('banks').innerText = `Banks: ${data.banks}`;
      document.getElementById('hospitals').innerText = `Hospitals: ${data.hospitals}`;
      document.getElementById('ngos').innerText = `NGOs: ${data.ngos}`;
      document.getElementById('schools').innerText = `Schools: ${data.schools}`;
      document.getElementById('colleges').innerText = `Colleges: ${data.colleges}`;
      document.getElementById('postal').innerText = `Post Offices: ${data.postal}`;
    })
    .catch(err => {
      console.error(err);
      window.location.href = 'maintenance.html';
    });
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const pages = {
    area: 'area.html',
    population: 'population.html',
    literacy: 'literacy.html',
    blocks: 'blocks.html',
    villages: 'villages.html',
    municipality: 'municipality.html',
    police: 'police.html',
    banks: 'banks.html',
    hospitals: 'hospitals.html',
    ngos: 'ngos.html',
    schools: 'schools.html',
    colleges: 'colleges.html',
    postal: 'postal.html',
  };

  Object.entries(pages).forEach(([id, page]) => {
    const el = document.getElementById(id);
    if (el) {
      el.style.cursor = 'pointer';
      el.addEventListener('click', (e) => {
        e.preventDefault(); // prevent default <a> behavior
        fetch(page, { method: 'HEAD' })
          .then((res) => {
            if (res.ok) {
              window.location.href = `${page}${window.location.search}`;
            } else {
              window.location.href = 'maintenance.html';
            }
          })
          .catch(() => {
            window.location.href = 'maintenance.html';
          });
      });
    }
  });
});
</script>

<script>
  // Check if user is logged in
  fetch('/api/me')
    .then(res => res.json())
    .then(user => {
      if (user.loggedIn) {
        const navbar = document.querySelector('.navbar .d-flex');
        navbar.innerHTML = `
          <span class="text-white me-2">Welcome, ${user.email.split('@')[0]}</span>
          <a href="/logout" class="btn btn-danger btn-sm">Logout</a>
        `;
      }
    });
</script>

</body>
</html>
